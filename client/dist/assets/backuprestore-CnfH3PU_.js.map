{"version":3,"file":"backuprestore-CnfH3PU_.js","sources":["../../src/pages/backuprestore.jsx"],"sourcesContent":["import { useRef, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { api } from \"../utils/api.js\";\r\n\r\nexport default function BackupRestore() {\r\n  const fileRef = useRef();\r\n  const [busy, setBusy] = useState(false);\r\n  const nav = useNavigate();\r\n\r\n  async function download() {\r\n    setBusy(true);\r\n    try {\r\n      const res = await api(\"/api/admin/backup\");\r\n      const blob = await res.blob();\r\n      const url  = URL.createObjectURL(blob);\r\n      const a    = document.createElement(\"a\");\r\n      a.href = url;\r\n      a.download = \"boxtracker-backup.sqlite\";\r\n      a.click();\r\n      URL.revokeObjectURL(url);\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  async function restore(e) {\r\n    e.preventDefault();\r\n    const file = fileRef.current.files[0];\r\n    if (!file) return alert(\"Bitte Datei wählen.\");\r\n    if (!confirm(\"Bestehende Datenbank überschreiben?\")) return;\r\n    setBusy(true);\r\n    try {\r\n      const form = new FormData();\r\n      form.append(\"dump\", file);\r\n      await api(\"/api/admin/backup\", { method:\"PUT\", body:form });\r\n      alert(\"Backup eingespielt – bitte neu anmelden.\");\r\n      localStorage.clear();\r\n      nav(\"/login\", { replace:true });\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  const resetDb = () =>\r\n    confirm(\"ALLE Daten löschen?\") &&\r\n      api(\"/api/admin/reset\", { method:\"POST\" })\r\n        .then(()=>{ alert(\"Datenbank zurückgesetzt\"); nav(\"/boxes\"); });\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      <h1 className=\"text-2xl font-bold\">Backup / Restore</h1>\r\n\r\n      <button onClick={download} className=\"btn btn-primary\" disabled={busy}>\r\n        {busy ? \"Bitte warten …\" : \"Backup herunterladen\"}\r\n      </button>\r\n\r\n      <form onSubmit={restore} className=\"flex gap-4 items-center flex-wrap\">\r\n        <input type=\"file\" ref={fileRef} className=\"file-input file-input-bordered\" />\r\n        <button className=\"btn\" disabled={busy}>Wiederherstellen</button>\r\n      </form>\r\n\r\n      <button onClick={resetDb} className=\"btn btn-error\">Datenbank RESET</button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["BackupRestore","fileRef","useRef","busy","setBusy","useState","nav","useNavigate","download","blob","api","url","a","restore","e","file","form","resetDb","jsxs","jsx"],"mappings":"4FAIA,SAAwBA,GAAgB,CACtC,MAAMC,EAAUC,EAAAA,OAAA,EACV,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAS,EAAK,EAChCC,EAAMC,EAAA,EAEZ,eAAeC,GAAW,CACxBJ,EAAQ,EAAI,EACZ,GAAI,CAEF,MAAMK,EAAO,MADD,MAAMC,EAAI,mBAAmB,GAClB,KAAA,EACjBC,EAAO,IAAI,gBAAgBF,CAAI,EAC/BG,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAE,KAAOD,EACTC,EAAE,SAAW,2BACbA,EAAE,MAAA,EACF,IAAI,gBAAgBD,CAAG,CACzB,QAAA,CACEP,EAAQ,EAAK,CACf,CACF,CAEA,eAAeS,EAAQC,EAAG,CACxBA,EAAE,eAAA,EACF,MAAMC,EAAOd,EAAQ,QAAQ,MAAM,CAAC,EACpC,GAAI,CAACc,EAAM,OAAO,MAAM,qBAAqB,EAC7C,GAAK,QAAQ,qCAAqC,EAClD,CAAAX,EAAQ,EAAI,EACZ,GAAI,CACF,MAAMY,EAAO,IAAI,SACjBA,EAAK,OAAO,OAAQD,CAAI,EACxB,MAAML,EAAI,oBAAqB,CAAE,OAAO,MAAO,KAAKM,EAAM,EAC1D,MAAM,0CAA0C,EAChD,aAAa,MAAA,EACbV,EAAI,SAAU,CAAE,QAAQ,EAAA,CAAM,CAChC,QAAA,CACEF,EAAQ,EAAK,CACf,EACF,CAEA,MAAMa,EAAU,IACd,QAAQ,qBAAqB,GAC3BP,EAAI,mBAAoB,CAAE,OAAO,OAAQ,EACtC,KAAK,IAAI,CAAE,MAAM,yBAAyB,EAAGJ,EAAI,QAAQ,CAAG,CAAC,EAEpE,OACEY,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,qBAAqB,SAAA,mBAAgB,EAEnDA,EAAAA,IAAC,SAAA,CAAO,QAASX,EAAU,UAAU,kBAAkB,SAAUL,EAC9D,SAAAA,EAAO,iBAAmB,sBAAA,CAC7B,EAEAe,EAAAA,KAAC,OAAA,CAAK,SAAUL,EAAS,UAAU,oCACjC,SAAA,CAAAM,MAAC,SAAM,KAAK,OAAO,IAAKlB,EAAS,UAAU,iCAAiC,QAC3E,SAAA,CAAO,UAAU,MAAM,SAAUE,EAAM,SAAA,kBAAA,CAAgB,CAAA,EAC1D,QAEC,SAAA,CAAO,QAASc,EAAS,UAAU,gBAAgB,SAAA,iBAAA,CAAe,CAAA,EACrE,CAEJ"}